@using TTShang.AntDesignTheme.Blazor.Routing
@using TTShang.AntDesignTheme.Blazor.Themes.AntDesignTheme
@using Microsoft.Extensions.Options
@using TTShang.Blazor.Client.Pages
@using Microsoft.JSInterop
@inject IOptions<AbpRouterOptions> RouterOptions
@inject IJSRuntime JS
<Router AppAssembly="typeof(Program).Assembly" AdditionalAssemblies="RouterOptions.Value.AdditionalAssemblies">
    <Found Context="routeData">
        <AuthorizeRouteView RouteData="routeData" DefaultLayout="typeof(DefaultLayout)">
            <NotAuthorized>
                <RedirectToLogin />
            </NotAuthorized>
        </AuthorizeRouteView>
    </Found>
    <NotFound>
        <PageTitle>404 - Not Found</PageTitle>
        <LayoutView Layout="typeof(DefaultLayout)">
            <NotFound />
        </LayoutView>
    </NotFound>
</Router>

@code {
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        await base.OnAfterRenderAsync(firstRender);
        
        if (firstRender)
        {
            // Hide the loading mask after the first render completes
            try
            {
                await JS.InvokeVoidAsync("hideAppLoadingMask");
            }
            catch
            {
                // Silently catch any JS interop errors
                // The mask will remain visible if this fails, but won't crash the app
            }
        }
    }
}